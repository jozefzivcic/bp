<!DOCTYPE html>
<html lang="en">
<head>
    {% include 'include_head.html' %}
    <title>{{ tests_in_group }}</title>
</head>
<body>
    {% include 'header.html' %}

    <div class="container">
        <div class="row">
            <form method="post" accept-charset="utf-8" name="show_pdf" action="/show_pdf" onsubmit="return checkForm()">
            <div class="col-md-12">
                <div class="col-md-8">
                    <div class="row">
                        <div class="col-md-12">
                            <h2>{{ tests_in_group }}</h2>
                        </div>
                    </div>
                    <div class="row">
                            <div class="row">
                                <div class="col-md-12">
                                    <table class="table">
                                        <tr>
                                            <th>
                                                <input type="checkbox" class="checkbox" name="select_all_tests" onclick="toggle(this)">
                                            </th>
                                            <th>{{ test }} {{ id }}</th>
                                            <th>{{ test_type }}</th>
                                            <th>{{ test_name }}</th>
                                            <th>{{ file }}</th>
                                            <th>{{ time_of_add }}</th>
                                            <th>{{ more }}</th>
                                        </tr>
                                        {% for test in vars['tests'] %}
                                            <tr>
                                                <td><input type="checkbox" class="checkbox" name="ch_test_{{ test.id }}"></td>
                                                <td>{{ test.id }}</td>
                                                <td>{{ test.test_table }}</td>
                                                <td>
                                                    {{ vars['params'][test.id].get_test_name() }}
                                                    <input type="hidden" name="num_of_data_for_test_id_{{ test.id }}"
                                                           value="{{ vars['params'][test.id].get_num_of_data_files() }}">
                                                </td>
                                                <td>{{ vars['files'][test.file_id].name }}</td>
                                                <td>{{ test.time_of_add }}</td>
                                                <td>
                                                    <a href="/test?id={{ test.id }}">info</a>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </table>
                                </div>
                            </div>

                    </div>
                </div>
                <div class="col-md-1">
                    <!--space -->
                </div>
                <div class="col-md-3">
                    <div class="row">
                        <div class="col-md-12">
                            <h2>{{ options }}</h2>
                        </div>
                    </div>
                    <div class="row">
                        <input  type="number" name="alpha" id="alpha" min="0.0" max="1.0" step="any" value="0.01">
                        <label for="alpha"> {{ alpha }}</label>
                    </div>
                    <div class="row">
                        <input type="checkbox" name="select_all_charts" id="select_all_charts" onclick="toggle(this)">
                        <label class="form-check-label" for="select_all_charts"> {{ select_all_charts }} </label>
                    </div>
                    <div class="row">
                        <input type="checkbox" name="ch_chart_type_1" id="ch_chart_type_1">
                        <label class="form-check-label" for="ch_chart_type_1"> {{ p_values_chart }} </label>
                    </div>
                    <div class="row">
                        <input type="checkbox" name="ch_chart_type_2" id="ch_chart_type_2">
                        <label class="form-check-label" for="ch_chart_type_2"> {{ zoomed_p_values }} </label>
                    </div>
                    <div class="row">
                        <input type="checkbox" name="ch_chart_type_3" id="ch_chart_type_3">
                        <label class="form-check-label" for="ch_chart_type_3"> {{ histogram }} </label>
                    </div>
                    <div class="row">
                        <input type="checkbox" name="ch_chart_type_4" id="ch_chart_type_4">
                        <label class="form-check-label" for="ch_chart_type_4">{{ two_tests_dep }}</label>
                    </div>
                    <div class="radio">
                        <input type="radio" name="optuniformity" id="optuniformity1" value="do_not_filter_unif" />
                        <label for="optuniformity1">{{ do_not_filter }}</label>
                    </div>
                    <div class="radio">
                        <input type="radio" name="optuniformity" id="optuniformity2" value="filter_unif" />
                        <label for="optuniformity2">{{ filter_uniform }}</label>
                    </div>
                    <div class="radio">
                        <input type="radio" name="optuniformity" id="optuniformity3" value="filter_non_unif">
                        <label for="optuniformity3">{{ filter_non_uniform }}</label>
                    </div>
                    <div class="row">
                        <input type="checkbox" name="ch_chart_type_5" id="ch_chart_type_5">
                        <label class="form-check-label" for="ch_chart_type_5">{{ ecdf }}</label>
                    </div>
                    <div class="row">
                        <input type="checkbox" name="ch_chart_type_6" id="ch_chart_type_6">
                        <label class="form-check-label" for="ch_chart_type_6">{{ boxplot_pt }}</label>
                    </div>
                    <div class="row">
                        <input class="btn btn-success" type="submit" value="{{ show_pdf }}">
                    </div>
                </div>

            </div>
            </form>
        </div>
    </div>
    <input type="hidden" name="alpha_not_filled" value="{{ alpha_not_filled }}">
    <input type="hidden" name="alpha_not_in_range" value="{{ alpha_not_in_range }}">
    <input type="hidden" name="no_test_checked" value="{{ no_test_checked }}">
    <input type="hidden" name="no_chart_checked" value="{{ no_chart_checked }}">
    <input type="hidden" id="no_unif_filter_selected" value="{{ no_unif_filter_selected }}">

<script language="JavaScript">
function toggle(source) {
    var inputs = document.getElementsByTagName("input");
    var prefix = '';
    if (source.name === 'select_all_tests')
        prefix = 'ch_test_';
    else if (source.name === 'select_all_charts')
        prefix = 'ch_chart_type_';
    for(var i = 0; i < inputs.length; i++) {
        if(inputs[i].name.indexOf(prefix) === 0) {
            inputs[i].checked = source.checked;
        }
    }
}

function checkForm() {
    var alpha = parseFloat(document.getElementsByName("alpha")[0].value);
    if (isNaN(alpha)) {
        alert(document.getElementsByName("alpha_not_filled")[0].value);
        return false;
    }
    if (alpha >= 1.0 || alpha <= 0.0) {
        alert(document.getElementsByName("alpha_not_in_range")[0].value);
        return false;
    }
    var inputs = document.getElementsByTagName("input");
    var test_checked = false;
    var chart_checked = false;
    for(var i = 0; i < inputs.length; i++) {
        if(inputs[i].name.indexOf('ch_test_') === 0 && inputs[i].checked)
            test_checked = true;
        if(inputs[i].name.indexOf('ch_chart_type_') === 0 && inputs[i].checked)
            chart_checked = true;
    }
    if (!test_checked) {
        alert(document.getElementsByName("no_test_checked")[0].value);
        return false;
    }

    if (!chart_checked) {
        alert(document.getElementsByName("no_chart_checked")[0].value);
        return false;
    }

    var test_dep_checked = document.getElementById("ch_chart_type_4").checked;
    if (test_dep_checked) {
        var checked1 = document.getElementById("optuniformity1").checked;
        var checked2 = document.getElementById("optuniformity2").checked;
        var checked3 = document.getElementById("optuniformity3").checked;
        if (!checked1 && !checked2 && !checked3) {
            alert(document.getElementById("no_unif_filter_selected").value);
            return false;
        }
    }
    return true;
}
</script>
</body>
</html>